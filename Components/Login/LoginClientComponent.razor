@namespace riwitalentfrontend.Components

@inject AuthenticationStateProvider autenticacionProvider;
@inject AuthService AuthService;
@inject ISessionStorageService SessionStorage
@using Blazored.SessionStorage
@inject NavigationManager NavigationManager;
@inject HttpClient HttpClient;
@inject SweetAlertService Swal;
@inject AlertService AlertService;

<MudGrid Class="pa-0 ma-0">
    <MudContainer Class="d-flex justify-center align-center pa-2 flex-grow-1">
        <MudCard Class="pa-6 d-flex justify-center align-center rounded-lg">
            <MudCardHeader>
                <MudItem Class="d-flex justify-center align-center">
                    <LogoComponent IsDarkMode="@_isDarkMode" />
                </MudItem>
            </MudCardHeader>
            <MudItem>
                <MudText Align="Align.Center" Typo="Typo.h5"><b>¡Bienvenido/a de nuevo!</b></MudText>
                <MudText Align="Align.Center" Typo="Typo.subtitle1">Ingresa con tu cuenta para continuar</MudText>
            </MudItem>
            <MudCardContent Class="FullWidth" Style="width: 100%;">
                <MudForm Spacing="2">
                    <MudTextField T="string" Label="Correo" @bind-value="_email" Variant="Variant.Outlined" InputType="InputType.Email"/>
                    <MudTextField T="string" Label="Contraseña" @bind-Value="_password" Variant="Variant.Outlined" InputType="@PasswordInput" IconSize="Size.Small" Adornment="Adornment.End" AdornmentIcon="@PasswordInputIcon" OnAdornmentClick="ButtonTestclick" AdornmentAriaLabel="Ver Contraseña"/>
                </MudForm>
            </MudCardContent>
            <MudCardActions>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="Login">Continuar</MudButton>
            </MudCardActions>
        </MudCard>
    </MudContainer>
</MudGrid>

@code {
    private string? _email;
    private string? _password;
    private bool _isDarkMode { get; set; }

    bool isShow;
    InputType PasswordInput = InputType.Password;
    string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;

    void ButtonTestclick()
    {
        @if (isShow)
        {
            isShow = false;
            PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
            PasswordInput = InputType.Password;
        }
        else {
            isShow = true;
            PasswordInputIcon = Icons.Material.Filled.Visibility;
            PasswordInput = InputType.Text;
        }
    }
    
    private async Task Login()
    {
        var succes = await AuthService.Login(_email, _password);
        
        if (succes)
        {
             // Guardar el correo en SessionStorage
            await SessionStorage.SetItemAsync("userEmail", _email);

            NavigationManager.NavigateTo("/home");
            await Swal.FireAsync(new SweetAlertOptions
            {   
                Title = "¡Bienvenido",
                Position = "top-end",
                Icon = SweetAlertIcon.Success,
                ShowConfirmButton = false ,
                Timer = 1500
            });
        }
        else
        {
            await Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Correo o contraseña incorrectos!",
                Text = "",
                Icon = SweetAlertIcon.Warning,
                ConfirmButtonText = "Intenta de nuevo",
                Timer = 1500
            });
        }
    }

}

